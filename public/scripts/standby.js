// Generated by CoffeeScript 1.7.1
(function() {
  var waitForLoaded;

  $(function() {
    console.log("done");
    window.onload = function() {
      return console.log('loaded');
    };
    return $('.cache').each(function(i, el) {
      var $el;
      $el = $(el);
      return $.get('/cache', {
        url: el.href
      }, function(html) {
        var id, iframe;
        console.log("fetched " + el.href);
        id = $el.data('id');
        iframe = document.getElementById(id);
        iframe = iframe.contentWindow || iframe.contentDocument.document || iframe.contentDocument;
        iframe.document.open();
        iframe.document.write(html);
        iframe.document.close();
        waitForLoaded(id, $el, function(el) {
          return el.addClass('loaded');
        });
        return $el.on('click', function(e) {
          e.preventDefault();
          id = $(this).data('id');
          return $("#" + id).css('display', 'block');
        });
      });
    });
  });

  waitForLoaded = function(id, $el, cb) {
    var iframe;
    iframe = document.getElementById(id);
    if (iframe.contentWindow && iframe.contentWindow.document && iframe.contentWindow.document.body && iframe.contentWindow.document.body.innerHTML) {
      console.log('loaded!!!!!!!!!!!');
      return setTimeout((function() {
        return cb($el);
      }), 500);
    } else {
      return setTimeout((function() {
        return waitForLoaded(id, $el, cb);
      }), 333);
    }
  };

}).call(this);
